<view class="page">
  <view class="header">
    <text class="title">系统设置</text>
  </view>

  <!-- 连接配置 -->
  <view class="card">
    <text class="card-title">服务器连接</text>
    <view class="field">
      <text class="label">HTTP地址</text>
      <input class="input" value="{{httpBase}}" bindinput="onHttpInput" placeholder="http://192.168.x.x:8000"/>
    </view>
    <view class="field">
      <text class="label">WebSocket</text>
      <input class="input" value="{{wsUrl}}" bindinput="onWsInput" placeholder="ws://192.168.x.x:8000/ws"/>
    </view>
    <view class="field-row">
      <button class="btn-save" bindtap="saveServer">保存并重连</button>
      <button class="btn-test" bindtap="testConnection">测试连接</button>
    </view>
    <view class="conn-status {{connOk ? 'status-ok' : 'status-err'}}">
      <text>{{connMsg}}</text>
    </view>
  </view>

  <!-- 预设 -->
  <view class="card">
    <text class="card-title">快捷预设</text>
    <view class="preset-list">
      <view class="preset" bindtap="applyPreset" data-host="127.0.0.1">
        <text class="preset-name">本机调试</text>
        <text class="preset-addr">127.0.0.1:8000</text>
      </view>
      <view class="preset" bindtap="applyPreset" data-host="192.168.1.100">
        <text class="preset-name">树莓派(有线)</text>
        <text class="preset-addr">192.168.1.100:8000</text>
      </view>
      <view class="preset" bindtap="applyPreset" data-host="192.168.4.1">
        <text class="preset-name">树莓派(AP)</text>
        <text class="preset-addr">192.168.4.1:8000</text>
      </view>
    </view>
  </view>

  <!-- 系统信息 -->
  <view class="card">
    <text class="card-title">系统信息</text>
    <view class="info-item">
      <text class="info-label">后端状态</text>
      <text class="info-value {{serverStatus === 'OK' ? 'text-ok' : 'text-err'}}">{{serverStatus}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">运行目录</text>
      <text class="info-value info-small">{{runDir || '-'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">链路状态</text>
      <text class="info-value">{{linkStatus || '-'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">FSM状态</text>
      <text class="info-value">{{fsmState || '-'}}</text>
    </view>
  </view>

  <view class="card">
    <text class="card-title">版本</text>
    <text class="version">通感之眼 2.0 v0.2</text>
  </view>
</view>
