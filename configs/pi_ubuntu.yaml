# Ubuntu 24.04 LTS (ARM64) 树莓派配置 - 通感之眼2.0
# 适用于：Raspberry Pi 5，2GB 内存，Ubuntu 24.04.x
# 与 pi_stereo.yaml 结构相同，串口路径使用 Ubuntu 默认值

run:
  output_root: runs
  duration_sec: 0          # 0 = 持续运行
  stats_interval_sec: 10

logging:
  level: INFO
  jsonl: true
  dir: logs

# === 视觉相机（yolo_infer 独占 /dev/video0） ===
camera:
  # yolo_infer.py 独占 /dev/video0 做实时推理，run_acq 不开相机避免冲突
  enabled: false
  mode: device
  device_index: 0
  width: 2160           # Sunplus 并排双目实际宽度
  height: 1080
  fps: 3                # 该分辨率下 V4L2 最高 3fps
  codec: mp4v
  snapshot_interval_sec: 5
  jpeg_quality: 75

# === 热成像相机（thermal_infer.py 独占 /dev/video1） ===
thermal:
  enabled: true
  mode: device          # device | mock
  device_index: 1       # 通常 /dev/video1（PureThermal USB / SEEK Compact）
  fov_deg: 50           # 热成像镜头水平 FOV（度），按实际值修改
  hotspot_percentile: 95
  min_area_px: 30
  max_fps: 9.0
  emit_no_signal: true
  no_signal_interval_sec: 2.0
  save_snapshots: true
  snapshot_interval_sec: 10

# === 麦克风阵列（doa_runner.py） ===
audio:
  enabled: true
  mode: mic
  device_index: 0
  sample_rate: 16000
  channels: 2
  block_ms: 20
  overrun_warn: 3

# === DOA 声源定位参数 ===
doa:
  mic_distance_m: 0.05
  speed_sound_m_s: 343.0
  sample_rate: 16000
  block_ms: 100
  overlap_ratio: 0.5
  smoothing: 0.4
  conf_threshold: 0.1
  window: hann
  pair_mode: reference
  pre_emphasis: 0.97
  max_history: 50

# === 遥测（MAVLink） ===
# Ubuntu + Pixhawk USB → /dev/ttyACM0（Pi OS 上通常是 /dev/ttyAMA0）
telemetry:
  enabled: true
  mode: mavlink_udp
  emit_hz: 2
  link_degraded_after_sec: 2
  link_lost_after_sec: 5
  mavlink:
    udp: "udp:0.0.0.0:14551"
    # Ubuntu 直连 Pixhawk USB 串口
    serial_port: "/dev/ttyACM0"
    baud: 115200

# === 观测融合（三路实时融合） ===
observation:
  enabled: true
  mode: fused_live
  fused_live_poll_sec: 0.05
  fused_emit_interval_sec: 0.2
  fused_max_gap_ms: 600
  no_signal_interval_sec: 2.0

# === 服务配置 ===
service:
  host: "0.0.0.0"
  port: 8000
  gcs_label: "ubuntu2404-pi5"
  status_interval_sec: 1
  telemetry_timeout_sec: 3
  ws_heartbeat_interval_sec: 30
  ws_heartbeat_timeout_sec: 60
  command_rate_limit_hz: 2
  command_whitelist:
    - SET_YAW
    - SET_MODE
    - STOP

# === 存储策略 ===
storage:
  max_runs: 5
  max_run_size_mb: 500
  low_space_warn_mb: 1000
  auto_cleanup: true
